<!doctype html>
<html lang="fr">
<head>
  <base target="_top">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fiche prospect – AirCooling</title>

<style>
  :root{
    --primary:#0077c8;
    --primary-soft:#e6f2fb;
    --border:#dcdcdc;
    --bg:#f5f5f7;
    --text:#0f172a;
    --muted:#64748b;
    --radius:16px;
    --shadow: 0 14px 40px rgba(2,6,23,.10);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    font-family:system-ui,-apple-system,Segoe UI,sans-serif;
    margin:0;
    padding:16px;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    text-rendering:optimizeLegibility;
  }
  input,select,textarea,button{font:inherit}
  button{touch-action:manipulation}

  .wrapper{
    max-width:820px;
    margin:0 auto;
    padding-bottom:110px;
  }
  .card{
    background:#fff;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    overflow:hidden;
    border:1px solid rgba(15,23,42,.06);
  }

  header.top{
    padding:18px 16px 14px;
    border-bottom:1px solid #e5e7eb;
    text-align:center;
  }
  .brand{
    font-size:22px;
    font-weight:1000;
    color:var(--primary);
    margin:0;
  }
  .subtitle{
    margin:8px 0 0;
    font-size:13px;
    color:#475569;
    line-height:1.45;
  }
  .pill{
    display:inline-block;
    margin-top:12px;
    padding:7px 12px;
    font-size:11px;
    font-weight:1000;
    border-radius:999px;
    background:var(--primary-soft);
    color:var(--primary);
    text-transform:uppercase;
    letter-spacing:.06em;
  }

  .wizardBar{
    position:sticky;
    top:0;
    z-index:30;
    background:rgba(255,255,255,.92);
    backdrop-filter: blur(10px);
    border-bottom:1px solid #e5e7eb;
    padding:12px;
    display:flex;
    gap:12px;
    align-items:center;
  }
  .wizardBar .left{flex:1;min-width:0}
  .wizardTitle{margin:0;font-size:15px;font-weight:1000}
  .wizardMeta{font-size:12px;color:var(--muted);margin-top:3px}
  .wizardProgress{
    height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin-top:8px;
  }
  .wizardProgress > div{height:100%;width:0%;background:var(--primary)}
  .startBtn{
    border:0;border-radius:999px;
    padding:12px 14px;
    font-weight:1000;
    background:var(--primary);
    color:#fff;
    cursor:pointer;
    white-space:nowrap;
    box-shadow: 0 10px 22px rgba(0,119,200,.22);
  }

  .stepsWrap{padding:16px}
  .step{display:none}
  .step.active{display:block}
  .stepCard{
    border:1px solid #e5e7eb;
    border-radius:18px;
    box-shadow:0 10px 26px rgba(2,6,23,.07);
    padding:16px;
    background:#fff;
  }
  .stepLabel{
    margin:0 0 6px;
    font-size:12px;
    color:var(--muted);
    font-weight:1000;
    text-transform:uppercase;
    letter-spacing:.02em;
  }
  .stepHeading{
    margin:0 0 14px;
    font-size:20px;
    font-weight:1000;
    letter-spacing:.2px;
  }
  label{
    display:block;
    font-size:12px;
    color:var(--muted);
    margin:12px 0 7px;
    font-weight:1000;
  }

  input,select,textarea{
    width:100%;
    padding:16px 14px;
    font-size:16px;
    border:1px solid #d1d5db;
    border-radius:14px;
    outline:none;
    background:#fff;
    scroll-margin-top:92px;
  }
  input:focus,select:focus,textarea:focus{
    border-color: rgba(0,119,200,.65);
    box-shadow: 0 0 0 4px rgba(0,119,200,.15);
  }
  textarea{min-height:160px;resize:vertical}

  .row2{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:720px){
    body{padding:22px}
    .stepsWrap{padding:18px}
    header.top{text-align:left}
    .brand{font-size:24px}
    .row2{grid-template-columns:1fr 1fr}
  }

  .hint{font-size:12px;color:#ef4444;font-weight:1000;margin-top:10px;display:none}
  .hint.show{display:block}
  .note{font-size:12px;color:#64748b;margin-top:8px;line-height:1.45}

/* ===== NAV (INLINE, under fields) ===== */
.wrapper{ padding-bottom: 0 !important; }  /* plus besoin de place pour une barre fixe */

.wizardNav{
  position: static !important;
  left:auto !important; right:auto !important; bottom:auto !important;
  z-index:auto !important;

  margin-top: 14px;
  padding: 0;
  background: transparent;
  backdrop-filter: none;
  border-top: 0;
  display: none; /* affiché seulement quand wizardOn */
}

.wizardNavInner{
  max-width: 100%;
  margin: 0;
  display: flex;
  gap: 12px;
}

.wizBtn{
  flex: 1;
  border: 0;
  border-radius: 18px;
  padding: 18px 16px;       /* PLUS GROS */
  font-size: 19px;          /* PLUS GROS */
  font-weight: 1000;
  cursor: pointer;
  box-shadow: 0 10px 22px rgba(2,6,23,.10);
}
.back{background:#e5e7eb;color:#0f172a}
.next{background:var(--primary);color:#fff}

/* ===== BIG MOBILE MODE ===== */
@media (max-width: 520px){
  html{ font-size: 19px; }            /* grossit TOUT (rem, texte etc.) */
  body{ padding: 12px !important; }

  .brand{ font-size: 28px !important; }
  .stepHeading{ font-size: 24px !important; }

  label{ font-size: 14px !important; }

  input,select,textarea{
    font-size: 19px !important;       /* évite le “mini” iPhone */
    padding: 18px 14px !important;
    border-radius: 16px !important;
  }

  .chip{
    padding: 16px !important;
    font-size: 17px !important;
    border-radius: 18px !important;
  }

  .sigArea{ height: 260px !important; }
}

/* ✅ Force 1 colonne dès que c’est "mobile-like" (même si Safari fait un viewport large) */
@media (max-width: 980px){
  .row2{ grid-template-columns: 1fr !important; }
}

/* ✅ Chips/radios : en pile sur mobile pour éviter l’écrasement */
@media (max-width: 980px){
  .chips{ flex-direction: column !important; }
  .chip{
    min-width: 100% !important;
    width: 100% !important;
  }
}



</style>
</head>

<body>
  <div class="wrapper">
    <div class="card">

      <header class="top">
        <p class="brand">AirCooling</p>
        <p class="subtitle">Fiche prospect — encodage rapide pour techniciens</p>
        <span class="pill">Prospect</span>
      </header>

      <!-- Wizard bar -->
      <div class="wizardBar">
        <div class="left">
          <p class="wizardTitle">Mode technicien</p>
          <div class="wizardMeta"><span id="wizCounter">—</span></div>
          <div class="wizardProgress"><div id="wizProgressFill"></div></div>
        </div>
        <button type="button" class="startBtn" id="startBtn">Remplir champs</button>
      </div>

      <form id="prospectForm" method="post" action="<?= scriptUrl ?>">
        <input type="hidden" name="formType" value="PROSPECT">

        <div class="stepsWrap">
          <div class="hint" id="wizHint"></div>

          <!-- STEP 1 -->
          <section class="step" data-step>
            <div class="stepCard">
              <p class="stepLabel">Étape 1</p>
              <h3 class="stepHeading">Infos de base</h3>

              <label>Date_Prospect *</label>
              <input type="date" name="Date_Prospect" required>

              <label>Type_Client *</label>
              <select name="Type_Client" required>
                <option value="">—</option>
                <option value="Particulier">Particulier</option>
                <option value="Professionnel">Professionnel</option>
              </select>
            </div>
          </section>

          <!-- STEP 2 -->
          <section class="step" data-step>
            <div class="stepCard">
              <p class="stepLabel">Étape 2</p>
              <h3 class="stepHeading">Contact</h3>

              <label>Nom *</label>
              <input type="text" name="Nom" required placeholder="Nom client ou entreprise">

              <label>Téléphone *</label>
              <input type="tel" name="Telephone" required placeholder="+32 ...">

              <label>Email</label>
              <input type="email" name="Email" placeholder="email@...">

              <label>Source</label>
              <select name="Source">
                <option value="">—</option>
                <option value="Appel">Appel</option>
                <option value="WhatsApp">WhatsApp</option>
                <option value="Site">Site</option>
                <option value="Recommandation">Recommandation</option>
                <option value="Autre">Autre</option>
              </select>
            </div>
          </section>

          <!-- STEP 3 -->
          <section class="step" data-step>
            <div class="stepCard">
              <p class="stepLabel">Étape 3</p>
              <h3 class="stepHeading">Adresse</h3>

              <label>Adresse *</label>
              <input type="text" name="Adresse" required placeholder="Rue + numéro">

              <div class="row2">
                <div>
                  <label>Localité *</label>
                  <input type="text" name="Localite" required placeholder="Ville">
                </div>
                <div>
                  <label>Code_Postal *</label>
                  <input type="text" name="Code_Postal" required placeholder="1000">
                </div>
              </div>
            </div>
          </section>

          <!-- STEP 4 -->
          <section class="step" data-step>
            <div class="stepCard">
              <p class="stepLabel">Étape 4</p>
              <h3 class="stepHeading">Demande</h3>

              <label>Type_Demande *</label>
              <select name="Type_Demande" required>
                <option value="">—</option>
                <option value="Climatisation">Climatisation</option>
                <option value="Ventilation">Ventilation</option>
                <option value="Chauffage">Chauffage</option>
                <option value="Entretien">Entretien</option>
                <option value="Dépannage">Dépannage</option>
                <option value="Autre">Autre</option>
              </select>

              <label>Description_Demande *</label>
              <textarea name="Description_Demande" required placeholder="Explique brièvement le besoin..."></textarea>
            </div>
          </section>

          <!-- STEP 5 -->
          <section class="step" data-step>
            <div class="stepCard">
              <p class="stepLabel">Étape 5</p>
              <h3 class="stepHeading">Détails (optionnel)</h3>

              <div class="row2">
                <div>
                  <label>Marque_Souhaitee</label>
                  <input type="text" name="Marque_Souhaitee" placeholder="Daikin, Mitsubishi...">
                </div>
                <div>
                  <label>Nombre_Unites</label>
                  <input type="number" name="Nombre_Unites" min="0" step="1" placeholder="ex: 2">
                </div>
              </div>

              <label>Photos_URL</label>
              <input type="text" name="Photos_URL" placeholder="Lien Drive / WhatsApp / ...">
              <div class="note">Colle un lien (Drive, WeTransfer, etc.).</div>

              <label>Video_URL</label>
              <input type="text" name="Video_URL" placeholder="Lien vidéo">
            </div>
          </section>

          <!-- STEP 6 -->
          <section class="step" data-step>
            <div class="stepCard">
              <p class="stepLabel">Étape 6</p>
              <h3 class="stepHeading">Suivi (optionnel)</h3>

              <div class="row2">
                <div>
                  <label>Visite_Technique_Date</label>
                  <input type="date" name="Visite_Technique_Date">
                </div>
                <div>
                  <label>Visite_Technique_Heure</label>
                  <input type="time" name="Visite_Technique_Heure">
                </div>
              </div>

              <label>Technicien_Assigne</label>
              <input type="text" name="Technicien_Assigne" placeholder="Nom technicien">

              <label>Statut</label>
              <select name="Statut">
                <option value="Nouveau">Nouveau</option>
                <option value="A contacter">A contacter</option>
                <option value="Visite planifiée">Visite planifiée</option>
                <option value="Devis envoyé">Devis envoyé</option>
                <option value="Gagné">Gagné</option>
                <option value="Perdu">Perdu</option>
              </select>
            </div>
          </section>

          <!-- STEP 7 -->
          <section class="step" data-step>
            <div class="stepCard">
              <p class="stepLabel">Étape 7</p>
              <h3 class="stepHeading">Devis & lien BON</h3>

              <div class="row2">
                <div>
                  <label>Devis_Montant_Estimatif (€)</label>
                  <input type="number" step="0.01" name="Devis_Montant_Estimatif" placeholder="0.00">
                </div>
                <div>
                  <label>Devis_Montant_Final (€)</label>
                  <input type="number" step="0.01" name="Devis_Montant_Final" placeholder="0.00">
                </div>
              </div>

              <label>Signature_Acceptation_URL</label>
              <input type="text" name="Signature_Acceptation_URL" placeholder="Lien si signature/acceptation">

              <label>Bon_Lie_ID</label>
              <input type="text" name="Bon_Lie_ID" placeholder="BON-... (si déjà lié)">
            </div>
          </section>

          <!-- STEP 8 -->
          <section class="step" data-step>
            <div class="stepCard">
              <p class="stepLabel">Dernière étape</p>
              <h3 class="stepHeading">Notes internes</h3>

              <label>Notes_Interne</label>
              <textarea name="Notes_Interne" placeholder="Notes internes..."></textarea>

              <div class="note" style="margin-top:10px">
                ✅ À l’étape suivante, tu seras redirigé automatiquement vers <b>“Dessiner le plan”</b>.
              </div>

              <!-- Submit hidden (wizard triggers it) -->
              <button type="submit" id="hiddenSubmit" style="display:none">Submit</button>
            </div>
          </section>

        </div>
      </form>
    </div>
  </div>

  <!-- Bottom nav -->
  <div class="wizardNav" id="wizardNav">
    <div class="wizardNavInner">
      <button type="button" class="wizBtn back" id="btnBack">◀ Retour</button>
      <button type="button" class="wizBtn next" id="btnNext">Suivant ▶</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('prospectForm');
      const steps = Array.from(document.querySelectorAll('[data-step]'));
      const startBtn = document.getElementById('startBtn');
      const nav = document.getElementById('wizardNav');
      const btnBack = document.getElementById('btnBack');
      const btnNext = document.getElementById('btnNext');
      const counter = document.getElementById('wizCounter');
      const fill = document.getElementById('wizProgressFill');
      const hint = document.getElementById('wizHint');
      const hiddenSubmit = document.getElementById('hiddenSubmit');

      let idx = 0;
      let wizardOn = false;

      function showHint(msg){
        hint.textContent = msg || '';
        hint.classList.toggle('show', !!msg);
      }

      function setActive(i){
        idx = Math.max(0, Math.min(i, steps.length - 1));
        steps.forEach((s,k) => s.classList.toggle('active', k === idx));

        counter.textContent = `${idx+1}/${steps.length}`;
        fill.style.width = `${Math.round(((idx+1)/steps.length)*100)}%`;

        btnBack.disabled = (idx === 0);
        btnNext.textContent = (idx === steps.length - 1) ? 'Dessiner le plan ✅' : 'Suivant ▶';

        // ✅ nav sous les champs, dans la carte
        const card = steps[idx].querySelector('.stepCard');
        if (card){
          card.appendChild(nav);
          nav.style.display = 'block';
        }

        const first = steps[idx].querySelector('input,select,textarea,button');
        if (first && first.focus) setTimeout(() => first.focus(), 60);

        card?.scrollIntoView({ behavior:'smooth', block:'start' });
      }

      function validateStep(i){
        showHint('');
        const container = steps[i];
        const fields = Array.from(container.querySelectorAll('input,select,textarea'));

        for (const f of fields){
          if (!f.hasAttribute('required') || f.disabled) continue;

          if (f.type === 'checkbox' && !f.checked){
            showHint("Merci de cocher la case obligatoire.");
            return false;
          }

          if (f.type === 'radio'){
            const name = f.name;
            if (name){
              const any = container.querySelectorAll(`input[type="radio"][name="${CSS.escape(name)}"]:checked`).length > 0;
              if (!any){
                showHint("Merci de sélectionner une option.");
                return false;
              }
            }
            continue;
          }

          if (!String(f.value || '').trim()){
            showHint("Merci de remplir ce champ.");
            f.scrollIntoView({behavior:'smooth', block:'center'});
            f.focus?.();
            return false;
          }
        }
        return true;
      }

      function startWizard(){
        wizardOn = true;
        nav.style.display = 'block';
        startBtn.style.display = 'none';
        setActive(0);
      }

      startBtn.addEventListener('click', startWizard);

      btnBack.addEventListener('click', () => {
        showHint('');
        setActive(idx - 1);
      });

      btnNext.addEventListener('click', () => {
        if (!validateStep(idx)) return;

        // last step => submit => handleProspectPost_ => redirect prospect-plan
        if (idx === steps.length - 1){
          btnNext.disabled = true;
          btnNext.textContent = 'Envoi...';
          btnBack.disabled = true;
          hiddenSubmit.click();
          return;
        }

        setActive(idx + 1);
      });

      form.addEventListener('keydown', (e) => {
        if (!wizardOn) return;
        if (e.key === 'Enter'){
          const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : '';
          if (tag !== 'textarea'){
            e.preventDefault();
            btnNext.click();
          }
        }
      });

      // Initial state
      counter.textContent = `0/${steps.length}`;
      fill.style.width = `0%`;
      steps.forEach(s => s.classList.remove('active'));

      // safety: prevent “native submit” without wizard
      form.addEventListener('submit', (e) => {
        if (!wizardOn){
          e.preventDefault();
          startWizard();
        }
      });
    });
  </script>
</body>
</html>